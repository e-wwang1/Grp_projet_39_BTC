

# -*- coding: utf-8 -*-
"""
CY-Antibio-Tech project
Step 1 & 2 : CSV reading and fecal line plots

Authors: Wendy & Eloise
Academic year: 2024-2025

This version of the program:
- reads a CSV file
- detects all mice automatically
- plots fecal bacteria evolution for each mouse
"""

import math
from matplotlib import pyplot as plt

# --------------------------------------------------
# Ask user for CSV file name
# --------------------------------------------------

filepath = input("Enter the CSV file name (without .csv): ")
filepath = filepath + ".csv"
print("File used:", filepath)

# --------------------------------------------------
# Step 1 : display file content (simple check)
# --------------------------------------------------

def displayFile(filepath):
    fd = open(filepath, "r")
    line = fd.readline()

    while line != "":
        print(line.replace("\n", ""))
        line = fd.readline()

    fd.close()

displayFile(filepath)

# --------------------------------------------------
# Step 2 : detect all mouse IDs automatically
# --------------------------------------------------

mouse_list = []

fp = open(filepath, "r")

# skip header
line = fp.readline()
line = fp.readline()

while line != "":
    line = line.replace("\n", "")
    data = line.split(";")

    if len(data) == 11:
        mouse_id = data[4]
        if mouse_id not in mouse_list:
            mouse_list.append(mouse_id)

    line = fp.readline()

fp.close()

print("Number of mice detected:", len(mouse_list))

# --------------------------------------------------
# Step 3 : plot fecal data for each mouse
# --------------------------------------------------

figure, axes = plt.subplots()

for mouse_id in mouse_list:

    x = []
    y = []
    treatment = "?"

    fp = open(filepath, "r")

    # skip header
    line = fp.readline()
    line = fp.readline()

    while line != "":
        line = line.replace("\n", "")
        data = line.split(";")

        if len(data) == 11:
            sample_type = data[2]

            if data[4] == mouse_id and sample_type == "fecal":
                x.append(int(data[7]))                 # experimental day
                y.append(math.log10(float(data[8])))   # log bacteria
                treatment = data[5]

        line = fp.readline()

    fp.close()

    # choose color depending on treatment
    color = "blue"
    if treatment == "ABX":
    
        color = "red"

    axes.plot(x, y, color=color, alpha=0.5)

# --------------------------------------------------
# Graph details
# --------------------------------------------------

axes.set_xlabel("Experimental day")
axes.set_ylabel("Log10 live bacteria")
axes.set_title("Fecal bacteria evolution per mouse")

figure.savefig("fecal_bacteria_plot.png", dpi=150)
figure.show()

print("Graph generated successfully.")

